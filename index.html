<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Webã‚¯ãƒ¼ãƒãƒ³ç™ºè¡Œæ©Ÿ</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 50px;
      background-color: #f0f8ff;
    }
    button {
      padding: 16px 32px;
      font-size: 20px;
      border: none;
      border-radius: 8px;
      background-color: #28a745;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>ğŸ Webã‚¯ãƒ¼ãƒãƒ³ã‚’ç™ºè¡Œã™ã‚‹ ğŸ</h2>
  <p>ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚¯ãƒ¼ãƒãƒ³ã‚’ç™ºè¡Œã—ã¾ã™</p>
  <button onclick="issueCoupon()">ã‚¯ãƒ¼ãƒãƒ³ç™ºè¡Œ</button>

  <script>
    async function issueCoupon() {
      const today = new Date();
      const y = today.getFullYear();
      const m = ("0" + (today.getMonth() + 1)).slice(-2);
      const d = ("0" + today.getDate()).slice(-2);
      const issueDate = `${y}-${m}-${d}`;

      const expiry = new Date(today);
      expiry.setDate(expiry.getDate() + 90);
      const ey = expiry.getFullYear();
      const em = ("0" + (expiry.getMonth() + 1)).slice(-2);
      const ed = ("0" + expiry.getDate()).slice(-2);
      const expireDate = `${ey}-${em}-${ed}`;

      const data = {
        discount: "500å††",
        issueDate: issueDate,
        expireDate: expireDate
      };

      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycby9hDb_-R6TXajDYUNepdwqfiDIWdUXf5X787qSBm8ZYDxHdaB22Gx1tlMf7Bc17Ht49Q/exec", {
          method: "POST",
          mode: "no-cors", // æˆåŠŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå–ã‚Œãªã„ãŒã€é€ä¿¡ã¯ã§ãã‚‹
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data)
        });

        // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ãï¼‰
        const query = new URLSearchParams({
          discount: data.discount,
          issueDate: data.issueDate,
          expireDate: data.expireDate,
        });

        // ç®¡ç†ç•ªå·ã¯GASå´ã§æ±ºå®š â†’ coupon.htmlã§å†å–å¾—ã§ã‚‚OK
        window.location.href = `coupon.html?${query.toString()}`;
      } catch (err) {
        alert("ã‚¯ãƒ¼ãƒãƒ³ç™ºè¡Œã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        console.error(err);
      }
    }
  </script>
</body>
</html>
